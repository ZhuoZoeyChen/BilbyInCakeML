Theory {thyName = "AfsSD", thyImports = TheoryImports ["\"../lib/FunBucket\"","\"../adt/VfsT\"","\"../adt/WordArrayT\"","\"../lib/CogentMonad\""], thyBody = [TypeSynonym (TypeSyn {typeName = "byte", synonym = TyDatatype "U8" [], tsTypeVars = []}),TypeSynonym (TypeSyn {typeName = "page", synonym = TyDatatype "list" [TyDatatype "U8" []], tsTypeVars = []}),TypeSynonym (TypeSyn {typeName = "dir", synonym = TyArrow (TyDatatype "list" [TyDatatype "U8" []]) (TyDatatype "option" [TyDatatype "Ino" []]), tsTypeVars = []}),TypeSynonym (TypeSyn {typeName = "file_data", synonym = TyDatatype "list" [TyDatatype "page" []], tsTypeVars = []}),DataTypeDecl (Datatype {dtName = "afs_inode_type", dtCons = [DTCons {conName = "IDir", conTypes = [TyDatatype "dir" []]},DTCons {conName = "IReg", conTypes = [TyDatatype "file_data" []]},DTCons {conName = "ILnk", conTypes = [TyDatatype "list" [TyDatatype "U8" []]]}], dtTypeVars = []}),Definition (Def {defSig = Nothing, defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_inode_is_dir")) (TermIdent (Id "x"))) (QuantifiedTerm Exists [TermIdent (Id "v")] (TermBinOp Eq (TermApp (TermIdent (Id "IDir")) (TermIdent (Id "v"))) (TermIdent (Id "x"))))}),Definition (Def {defSig = Nothing, defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_inode_is_reg")) (TermIdent (Id "x"))) (QuantifiedTerm Exists [TermIdent (Id "v")] (TermBinOp Eq (TermApp (TermIdent (Id "IReg")) (TermIdent (Id "v"))) (TermIdent (Id "x"))))}),Definition (Def {defSig = Nothing, defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_inode_is_lnk")) (TermIdent (Id "x"))) (QuantifiedTerm Exists [TermIdent (Id "v")] (TermBinOp Eq (TermApp (TermIdent (Id "ILnk")) (TermIdent (Id "v"))) (TermIdent (Id "x"))))}),RecordDecl (Record {recName = "afs_inode", recFields = [RecField {fieldName = "i_type", fieldType = TyDatatype "afs_inode_type" []},RecField {fieldName = "i_ino", fieldType = TyDatatype "Ino" []},RecField {fieldName = "i_nlink", fieldType = TyDatatype "U32" []},RecField {fieldName = "i_size", fieldType = TyDatatype "U64" []},RecField {fieldName = "i_mtime", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "i_ctime", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "i_uid", fieldType = TyDatatype "U32" []},RecField {fieldName = "i_gid", fieldType = TyDatatype "U32" []},RecField {fieldName = "i_mode", fieldType = TyDatatype "Mode" []},RecField {fieldName = "i_flags", fieldType = TyDatatype "U32" []}], recTypeVars = []}),TypeSynonym (TypeSyn {typeName = "readdir_ctx", synonym = TyTuple (TyDatatype "U32" []) (TyDatatype "dir" []), tsTypeVars = []}),TypeSynonym (TypeSyn {typeName = "afs_map", synonym = TyArrow (TyDatatype "Ino" []) (TyDatatype "option" [TyDatatype "afs_inode" []]), tsTypeVars = []}),RecordDecl (Record {recName = "afs_state", recFields = [RecField {fieldName = "a_is_readonly", fieldType = TyPrim BoolT},RecField {fieldName = "a_current_time", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "a_medium_afs", fieldType = TyDatatype "afs_map" []},RecField {fieldName = "a_medium_updates", fieldType = TyDatatype "list" [TyArrow (TyDatatype "afs_map" []) (TyDatatype "afs_map" [])]}], recTypeVars = []}),Definition (Def {defSig = Just (Sig {sigName = "a_afs_updated_n", sigType = Just (TyArrow (TyPrim NatT) (TyArrow (TyDatatype "afs_map" []) (TyArrow (TyDatatype "list" [TyArrow (TyDatatype "afs_map" []) (TyDatatype "afs_map" [])]) (TyDatatype "afs_map" []))))}), defTerm = TermBinOp Eq (TermApp (TermApp (TermApp (TermIdent (Id "a_afs_updated_n")) (TermIdent (Id "n"))) (TermIdent (Id "afs_st"))) (TermIdent (Id "updates"))) (TermApp (TermApp (TermApp (TermIdent (Id "fold")) (TermIdent (Id "id"))) (TermApp (TermApp (TermIdent (Id "take")) (TermIdent (Id "n"))) (TermIdent (Id "updates")))) (TermIdent (Id "afs_st")))}),Declare (Dcl {dclName = "a_afs_updated_n", dclRules = ["simp"]}),Definition (Def {defSig = Just (Sig {sigName = "a_afs_updated", sigType = Just (TyArrow (TyDatatype "afs_map" []) (TyArrow (TyDatatype "list" [TyArrow (TyDatatype "afs_map" []) (TyDatatype "afs_map" [])]) (TyDatatype "afs_map" [])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "a_afs_updated")) (TermIdent (Id "afs_st"))) (TermIdent (Id "updates"))) (TermApp (TermApp (TermApp (TermIdent (Id "a_afs_updated_n")) (TermApp (TermIdent (Id "length")) (TermIdent (Id "updates")))) (TermIdent (Id "afs_st"))) (TermIdent (Id "updates")))}),Definition (Def {defSig = Just (Sig {sigName = "updated_afs", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyDatatype "afs_map" []))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "adata"))) (TermApp (TermApp (TermIdent (Id "a_afs_updated")) (TermApp (TermIdent (Id "a_medium_afs")) (TermIdent (Id "adata")))) (TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "adata"))))}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_type_dir", sigType = Just (TyArrow (TyDatatype "afs_inode_type" []) (TyDatatype "dir" []))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_type_dir")) (TermIdent (Id "it"))) (CaseOf (TermIdent (Id "it")) [(TermApp (TermIdent (Id "IDir")) (TermIdent (Id "dir")),TermIdent (Id "dir"))])}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_dir", sigType = Just (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "dir" []))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_dir")) (TermIdent (Id "i"))) (TermApp (TermIdent (Id "i_type_dir")) (TermApp (TermIdent (Id "i_type")) (TermIdent (Id "i"))))}),Definition (Def {defSig = Just (Sig {sigName = "i_dir_update", sigType = Just (TyArrow (TyArrow (TyDatatype "dir" []) (TyDatatype "dir" [])) (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "afs_inode" [])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "i_dir_update")) (TermIdent (Id "m"))) (TermIdent (Id "i"))) (TermApp (TermIdent (Id "i")) (RecordUpd [(TermIdent (Id "i_type"),TermApp (TermIdent (Id "IDir")) (TermApp (TermIdent (Id "m")) (TermApp (TermIdent (Id "i_dir")) (TermIdent (Id "i")))))]))}),Declare (Dcl {dclName = "i_dir_update", dclRules = ["simp"]}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_type_data", sigType = Just (TyArrow (TyDatatype "afs_inode_type" []) (TyDatatype "file_data" []))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_type_data")) (TermIdent (Id "it"))) (CaseOf (TermIdent (Id "it")) [(TermApp (TermIdent (Id "IReg")) (TermIdent (Id "data")),TermIdent (Id "data"))])}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_data", sigType = Just (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "file_data" []))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_data")) (TermIdent (Id "i"))) (TermApp (TermIdent (Id "i_type_data")) (TermApp (TermIdent (Id "i_type")) (TermIdent (Id "i"))))}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_data_update", sigType = Just (TyArrow (TyArrow (TyDatatype "file_data" []) (TyDatatype "file_data" [])) (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "afs_inode" [])))}), abbrevTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "i_data_update")) (TermIdent (Id "m"))) (TermIdent (Id "i"))) (TermApp (TermIdent (Id "i")) (RecordUpd [(TermIdent (Id "i_type"),TermApp (TermIdent (Id "IReg")) (TermApp (TermIdent (Id "m")) (TermApp (TermIdent (Id "i_data")) (TermIdent (Id "i")))))]))}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_type_path", sigType = Just (TyArrow (TyDatatype "afs_inode_type" []) (TyDatatype "list" [TyDatatype "byte" []]))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_type_path")) (TermIdent (Id "it"))) (CaseOf (TermIdent (Id "it")) [(TermApp (TermIdent (Id "ILnk")) (TermIdent (Id "path")),TermIdent (Id "path"))])}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_path", sigType = Just (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "list" [TyDatatype "byte" []]))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_path")) (TermIdent (Id "i"))) (TermApp (TermIdent (Id "i_type_path")) (TermApp (TermIdent (Id "i_type")) (TermIdent (Id "i"))))}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_path_update", sigType = Just (TyArrow (TyArrow (TyDatatype "list" [TyDatatype "byte" []]) (TyDatatype "list" [TyDatatype "byte" []])) (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "afs_inode" [])))}), abbrevTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "i_path_update")) (TermIdent (Id "m"))) (TermIdent (Id "i"))) (TermApp (TermIdent (Id "i")) (RecordUpd [(TermIdent (Id "i_type"),TermApp (TermIdent (Id "ILnk")) (TermApp (TermIdent (Id "m")) (TermApp (TermIdent (Id "i_path")) (TermIdent (Id "i")))))]))}),PrimRec (Prc {prcSig = Just (Sig {sigName = "i_size_from_afs_inode_type", sigType = Just (TyArrow (TyDatatype "afs_inode_type" []) (TyDatatype "U64" []))}), recCases = [(TermApp (TermIdent (Id "i_size_from_afs_inode_type")) (TermApp (TermIdent (Id "IDir")) (TermIdent (Id "dir"))),TermIdent (Id "undefined")),(TermApp (TermIdent (Id "i_size_from_afs_inode_type")) (TermApp (TermIdent (Id "IReg")) (TermIdent (Id "data"))),TermApp (TermIdent (Id "count")) (TermApp (TermIdent (Id "concat")) (TermIdent (Id "data")))),(TermApp (TermIdent (Id "i_size_from_afs_inode_type")) (TermApp (TermIdent (Id "ILnk")) (TermIdent (Id "path"))),TermApp (TermIdent (Id "count")) (TermIdent (Id "path")))]}),Abbreviation (Abbrev {abbrevSig = Just (Sig {sigName = "i_size_from_type", sigType = Just (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "U64" []))}), abbrevTerm = TermBinOp Equiv (TermApp (TermIdent (Id "i_size_from_type")) (TermIdent (Id "i"))) (TermBinOp DollarApp (TermIdent (Id "i_size_from_afs_inode_type")) (TermApp (TermIdent (Id "i_type")) (TermIdent (Id "i"))))}),Definition (Def {defSig = Just (Sig {sigName = "afs_inode_to_vnode", sigType = Just (TyArrow (TyDatatype "afs_inode" []) (TyDatatype "VfsInode" []))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_inode_to_vnode")) (TermIdent (Id "i"))) (RecordDcl [(TermIdent (Id "v_ino"),TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "i"))),(TermIdent (Id "v_nlink"),TermApp (TermIdent (Id "i_nlink")) (TermIdent (Id "i"))),(TermIdent (Id "v_size"),TermApp (TermIdent (Id "i_size")) (TermIdent (Id "i"))),(TermIdent (Id "v_mtime"),TermApp (TermIdent (Id "i_mtime")) (TermIdent (Id "i"))),(TermIdent (Id "v_ctime"),TermApp (TermIdent (Id "i_ctime")) (TermIdent (Id "i"))),(TermIdent (Id "v_uid"),TermApp (TermIdent (Id "i_uid")) (TermIdent (Id "i"))),(TermIdent (Id "v_gid"),TermApp (TermIdent (Id "i_gid")) (TermIdent (Id "i"))),(TermIdent (Id "v_mode"),TermApp (TermIdent (Id "i_mode")) (TermIdent (Id "i"))),(TermIdent (Id "v_flags"),TermApp (TermIdent (Id "i_flags")) (TermIdent (Id "i")))])}),Definition (Def {defSig = Just (Sig {sigName = "afs_inode_from_vnode", sigType = Just (TyArrow (TyDatatype "vnode" []) (TyDatatype "afs_inode" []))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_inode_from_vnode")) (TermIdent (Id "v"))) (RecordDcl [(TermIdent (Id "i_type"),IfThenElse (TermBinOp NotEq (TermApp (TermApp (TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "v"))) (TermIdent (Id "AND"))) (TermIdent (Id "s_IFREG"))) (ConstTerm (IntLiteral 0))) (TermApp (TermIdent (Id "IReg")) (ListTerm "[" [] "]")) (IfThenElse (TermBinOp NotEq (TermApp (TermApp (TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "v"))) (TermIdent (Id "AND"))) (TermIdent (Id "s_IFDIR"))) (ConstTerm (IntLiteral 0))) (TermApp (TermIdent (Id "IDir")) (TermIdent (Id "Map.empty"))) (TermApp (TermIdent (Id "ILnk")) (ListTerm "[" [] "]")))),(TermIdent (Id "i_ino"),TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "v"))),(TermIdent (Id "i_nlink"),TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "v"))),(TermIdent (Id "i_size"),TermApp (TermIdent (Id "v_size")) (TermIdent (Id "v"))),(TermIdent (Id "i_mtime"),TermApp (TermIdent (Id "v_mtime")) (TermIdent (Id "v"))),(TermIdent (Id "i_ctime"),TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "v"))),(TermIdent (Id "i_uid"),TermApp (TermIdent (Id "v_uid")) (TermIdent (Id "v"))),(TermIdent (Id "i_gid"),TermApp (TermIdent (Id "v_gid")) (TermIdent (Id "v"))),(TermIdent (Id "i_mode"),TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "v"))),(TermIdent (Id "i_flags"),TermApp (TermIdent (Id "v_flags")) (TermIdent (Id "v")))])}),Definition (Def {defSig = Just (Sig {sigName = "error_if_readonly", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyDatatype "cogent_monad" [TyDatatype "R" [TyTuple (TyDatatype "ErrCode" []) (TyDatatype "afs_state" []),TyDatatype "afs_state" []]]))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "error_if_readonly")) (TermIdent (Id "as"))) (TermBinOp DollarApp (TermIdent (Id "return")) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "as"))) (TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "eRoFs"),TermIdent (Id "as")] ")")) (TermApp (TermIdent (Id "Success")) (TermIdent (Id "as")))))}),Definition (Def {defSig = Just (Sig {sigName = "nondet_error", sigType = Just (TyArrow (TyDatatype "set" [TyDatatype "ErrCode" []]) (TyArrow (TyArrow (TyDatatype "ErrCode" []) (TyVar "a")) (TyDatatype "cogent_monad" [TyVar "a"])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "nondet_error")) (TermIdent (Id "errs"))) (TermIdent (Id "f"))) (TermBinOp Bind (TermApp (TermIdent (Id "CogentMonad.select")) (TermIdent (Id "errs"))) (TermBinOp Comp (TermIdent (Id "return")) (TermIdent (Id "f"))))}),Definition (Def {defSig = Just (Sig {sigName = "afs_alloc_inum", sigType = Just (TyArrow (TyDatatype "afs_map" []) (TyDatatype "cogent_monad" [TyDatatype "R" [TyDatatype "unit" [],TyDatatype "Ino" []]]))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_alloc_inum")) (TermIdent (Id "as"))) (DoBlock [DoItem (TermIdent (Id "avail_inums")) (TermBinOp DollarApp (TermIdent (Id "return")) (TermUnOp Uminus (TermApp (TermIdent (Id "dom")) (TermIdent (Id "as"))))),DoItem (TermIdent (Id "opt_inum")) (TermBinOp DollarApp (TermIdent (Id "select")) (TermBinOp Union (Set (Listing [TermIdent (Id "option.None")])) (TermBinOp Image (TermIdent (Id "option.Some")) (TermIdent (Id "avail_inums"))))),TermBinOp DollarApp (TermIdent (Id "return")) (IfThenElse (TermBinOp Eq (TermIdent (Id "opt_inum")) (TermIdent (Id "option.None"))) (TermApp (TermIdent (Id "Error")) (ListTerm "(" [] ")")) (TermApp (TermIdent (Id "Success")) (TermApp (TermIdent (Id "the")) (TermIdent (Id "opt_inum")))))])}),Definition (Def {defSig = Just (Sig {sigName = "afs_get_current_time", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyDatatype "cogent_monad" [TyTuple (TyDatatype "afs_state" []) (TyDatatype "TimeT" [])]))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "afs"))) (DoBlock [DoItem (TermIdent (Id "time'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "a_current_time")) (TermIdent (Id "afs")))),DoItem (TermIdent (Id "time")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermBinOp Ge (TermApp (TermIdent (Id "x.")) (TermIdent (Id "x"))) (TermIdent (Id "time'"))]))),TermApp (TermIdent (Id "return")) (ListTerm "(" [TermApp (TermIdent (Id "afs")) (RecordUpd [(TermIdent (Id "a_current_time"),TermIdent (Id "time"))]),TermIdent (Id "time'")] ")")])}),Definition (Def {defSig = Just (Sig {sigName = "afs_init_inode", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "VfsMode" []) (TyDatatype "cogent_monad" [TyDatatype "R" [TyTuple (TyDatatype "afs_state" []) (TyDatatype "vnode" []),TyTuple (TyDatatype "afs_state" []) (TyDatatype "vnode" [])]])))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_init_inode")) (TermIdent (Id "adata"))) (TermIdent (Id "vdir"))) (TermIdent (Id "vnode"))) (TermIdent (Id "mode"))) (DoBlock [DoItem (ListTerm "(" [TermIdent (Id "adata"),TermIdent (Id "time")] ")") (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "adata"))),DoItem (TermIdent (Id "uid")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_uid")) (TermIdent (Id "vdir")))),DoItem (TermIdent (Id "gid")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_gid")) (TermIdent (Id "vdir")))),DoItem (TermIdent (Id "vnode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_uid"),TermIdent (Id "uid")),(TermIdent (Id "v_gid"),TermIdent (Id "gid")),(TermIdent (Id "v_mode"),TermIdent (Id "mode")),(TermIdent (Id "v_nlink"),ConstTerm (IntLiteral 1)),(TermIdent (Id "v_size"),ConstTerm (IntLiteral 0))]))),DoItem (TermIdent (Id "r")) (TermApp (TermIdent (Id "afs_alloc_inum")) (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "adata")))),TermApp (TermIdent (Id "return")) (CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "adata"),TermIdent (Id "vnode")] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "inum")),TermApp (TermIdent (Id "Success")) (ListTerm "(" [TermIdent (Id "adata"),TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_ino"),TermIdent (Id "inum"))])] ")"))])])}),Definition (Def {defSig = Just (Sig {sigName = "read_afs_inode", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "Ino" []) (TyDatatype "cogent_monad" [TyDatatype "R\\<^sub>T" [TyDatatype "afs_inode" [],TyDatatype "ErrCode" []]])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "adata"))) (TermIdent (Id "ino"))) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "adata"))) (TermIdent (Id "ino")))))) (TermApp (TermApp (TermIdent (Id "nondet_error")) (Set (Listing [TermIdent (Id "eIO"),TermIdent (Id "eNoMem"),TermIdent (Id "eInval"),TermIdent (Id "eBadF")]))) (TermIdent (Id "Error"))))}),Definition (Def {defSig = Just (Sig {sigName = "afs_apply_updates_nondet", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyDatatype "cogent_monad" [TyDatatype "afs_state" []]))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_apply_updates_nondet")) (TermIdent (Id "afs"))) (DoBlock [DoItem (ListTerm "(" [TermIdent (Id "to_apply"),TermIdent (Id "updates")] ")") (Set (Quant (ListTerm "(" [TermIdent (Id "ap"),TermIdent (Id "up")] ")") (TermBinOp Eq (TermBinOp Append (TermIdent (Id "ap")) (TermIdent (Id "up"))) (TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "afs")))))),TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "afs")) (RecordUpd [(TermIdent (Id "a_medium_afs"),TermApp (TermApp (TermApp (TermIdent (Id "fold")) (TermIdent (Id "id"))) (TermIdent (Id "to_apply"))) (TermApp (TermIdent (Id "a_medium_afs")) (TermIdent (Id "afs")))),(TermIdent (Id "a_medium_updates"),TermIdent (Id "updates"))]))])}),Definition (Def {defSig = Just (Sig {sigName = "afs_update", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyArrow (TyDatatype "afs_map" []) (TyDatatype "afs_map" [])) (TyDatatype "cogent_monad" [TyTuple (TyDatatype "afs_state" []) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (TermIdent (Id "upd"))) (DoBlock [DoItem (TermIdent (Id "afs")) (TermApp (TermIdent (Id "afs_apply_updates_nondet")) (TermApp (TermIdent (Id "afs")) (RecordUpd [(TermIdent (Id "a_medium_updates"),TermBinOp Append (TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "afs"))) (ListTerm "[" [TermIdent (Id "upd")] "]"))]))),IfThenElse (TermBinOp Eq (TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "afs"))) (ListTerm "[" [] "]")) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")) (TermApp (TermApp (TermIdent (Id "nondet_error")) (Set (Listing [TermIdent (Id "eIO"),TermIdent (Id "eNoSpc"),TermIdent (Id "eNoMem")]))) (QuantifiedTerm Lambda [TermIdent (Id "e")] (ListTerm "(" [TermApp (TermIdent (Id "afs")) (RecordUpd [(TermIdent (Id "a_medium_updates"),TermApp (TermIdent (Id "butlast")) (TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "afs"))))]),TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")"))))])}),Definition (Def {defSig = Just (Sig {sigName = "afs_create", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "VfsMode" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "vnode" []))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_create")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "name"))) (TermIdent (Id "mode"))) (TermIdent (Id "vnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_init_inode")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "vnode"))) (TermApp (TermApp (TermIdent (Id "mode")) (TermIdent (Id "OR"))) (TermIdent (Id "s_IFREG")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNFile"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")"),DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "parentdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapsTo (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))))))) (TermIdent (Id "dir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "select")) (TermBinOp Image (TermIdent (Id "Success")) (Set (Listing [TermBinOp Greater (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "parentdir")))])))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eOverflow"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "newsz")),DoBlock [DoItem (TermIdent (Id "time")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "vnode")))),DoItem (TermIdent (Id "dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "dir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time"))]))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "afs_inode_from_vnode")) (TermIdent (Id "vnode")))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "inode"))) (TermIdent (Id "inode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "dir"))) (TermIdent (Id "dir"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "parentdir")) (RecordUpd [(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsz"))]),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]])]])]])]])]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_sync", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyDatatype "cogent_monad" [TyTuple (TyDatatype "afs_state" []) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))}), defTerm = TermBinOp Equiv (TermApp (TermIdent (Id "afs_sync")) (TermIdent (Id "afs"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "n")) (TermApp (TermIdent (Id "select")) (Set (Range (ConstTerm (IntLiteral 0)) (TermApp (TermIdent (Id "length")) (TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "afs"))))))),LetIn [(TermIdent (Id "updates"),TermApp (TermIdent (Id "a_medium_updates")) (TermIdent (Id "afs"))),(ListTerm "(" [TermIdent (Id "to_apply"),TermIdent (Id "updates")] ")",ListTerm "(" [TermApp (TermApp (TermIdent (Id "take")) (TermIdent (Id "n"))) (TermIdent (Id "updates")),TermApp (TermApp (TermIdent (Id "drop")) (TermIdent (Id "n"))) (TermIdent (Id "updates"))] ")"),(TermIdent (Id "afs"),TermApp (TermApp (TermIdent (Id "a_medium_afs_update")) (TermApp (TermApp (TermIdent (Id "fold")) (QuantifiedTerm Lambda [TermIdent (Id "upd"),TermIdent (Id "med")] (TermApp (TermIdent (Id "upd")) (TermIdent (Id "med"))))) (TermIdent (Id "to_apply")))) (TermIdent (Id "afs"))),(TermIdent (Id "afs"),TermApp (TermApp (TermIdent (Id "a_medium_updates_update")) (QuantifiedTerm Lambda [TermIdent Wildcard] (TermIdent (Id "updates")))) (TermIdent (Id "afs")))] (IfThenElse (TermBinOp Eq (TermIdent (Id "updates")) (ListTerm "[" [] "]")) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")) (DoBlock [DoItem (TermIdent (Id "e")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermIdent (Id "eIO"),TermIdent (Id "eNoMem"),TermIdent (Id "eNoSpc"),TermIdent (Id "eOverflow")]))),TermApp (TermIdent (Id "return")) (ListTerm "(" [TermApp (TermIdent (Id "afs")) (RecordUpd [(TermIdent (Id "a_is_readonly"),TermBinOp Eq (TermIdent (Id "e")) (TermIdent (Id "eIO")))]),TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")]))]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_unlink", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "vnode" []))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_unlink")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "name"))) (TermIdent (Id "vnode"))) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermIdent (Id "error_if_readonly")) (TermIdent (Id "afs"))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "e"),TermIdent (Id "afs")] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "afs")),DoBlock [DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "time")] ")") (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "afs"))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermApp (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))))) (RecordUpd [(TermIdent (Id "i_nlink"),TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "vnode"))) (ConstTerm (IntLiteral 1))),(TermIdent (Id "i_ctime"),TermIdent (Id "time"))]))),DoItem (TermIdent (Id "newsize")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermBinOp Less (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "parentdir")))]))),DoItem (TermIdent (Id "dir_ino")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "parentdir")))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermIdent (Id "dir_ino")) (TermApp (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermIdent (Id "option.None")))))) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermIdent (Id "f")) (TermIdent (Id "dir_ino"))))) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time"))])),TermBinOp MapsTo (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))) (TermIdent (Id "inode"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),LetIn [(TermIdent (Id "vnode'"),TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_nlink"),TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "vnode"))) (ConstTerm (IntLiteral 1))),(TermIdent (Id "v_ctime"),TermIdent (Id "time"))])),(TermIdent (Id "parentdir'"),TermApp (TermIdent (Id "parentdir")) (RecordUpd [(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsize"))]))] (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir'"),TermIdent (Id "vnode'")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")))]])]])}),Definition (Def {defSig = Just (Sig {sigName = "afs_iget", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "Ino" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyDatatype "vnode" []) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermIdent (Id "afs_iget")) (TermIdent (Id "afs"))) (TermIdent (Id "inum"))) (TermIdent (Id "vnode"))) (IfThenElse (TermBinOp In (TermIdent (Id "inum")) (TermApp (TermIdent (Id "dom")) (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))))) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermIdent (Id "inum"))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Success")) (TermIdent (Id "inode")),TermApp (TermIdent (Id "return")) (ListTerm "(" [TermApp (TermIdent (Id "afs_inode_to_vnode")) (TermIdent (Id "inode")),TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")),(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "vnode"),TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")"))]]) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "vnode"),TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNoEnt"))] ")")))}),Definition (Def {defSig = Just (Sig {sigName = "afs_lookup", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyDatatype "cogent_monad" [TyDatatype "R\\<^sub>T" [TyDatatype "Ino" [],TyDatatype "ErrCode" []]]))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermIdent (Id "afs_lookup")) (TermIdent (Id "afs"))) (TermIdent (Id "vdir"))) (TermIdent (Id "name"))) (IfThenElse (TermBinOp Greater (TermApp (TermIdent (Id "wordarray_length")) (TermIdent (Id "name"))) (TermBinOp Add (TermIdent (Id "bilbyFsMaxNameLen")) (ConstTerm (IntLiteral 1)))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong")))) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")))),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),CaseOf (TermApp (TermApp (TermIdent (Id "i_dir")) (TermIdent (Id "dir"))) (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name")))) [(TermIdent (Id "None"),TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNoEnt")))),(TermApp (TermIdent (Id "Some")) (TermIdent (Id "ino")),TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Success")) (TermIdent (Id "ino"))))])]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_link", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "vnode" []))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_link")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "name"))) (TermIdent (Id "vnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "parentdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapsTo (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))))))) (TermIdent (Id "dir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "select")) (TermBinOp Image (TermIdent (Id "Success")) (Set (Listing [TermBinOp Greater (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "parentdir")))])))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eOverflow"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "newsz")),DoBlock [DoItem (TermIdent (Id "time")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "vnode")))),DoItem (TermIdent (Id "dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "dir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_size"),TermIdent (Id "newsz"))]))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode")))))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "inode"))) (TermIdent (Id "inode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "dir"))) (TermIdent (Id "dir"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "parentdir")) (RecordUpd [(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsz"))]),TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_nlink"),TermBinOp Add (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "vnode"))) (ConstTerm (IntLiteral 1)))])] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]])]])]])]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_mkdir", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "VfsMode" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "vnode" []))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_mkdir")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "name"))) (TermIdent (Id "mode"))) (TermIdent (Id "vnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_init_inode")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "vnode"))) (TermApp (TermApp (TermIdent (Id "mode")) (TermIdent (Id "OR"))) (TermIdent (Id "s_IFDIR")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNFile"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")"),DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "parentdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapsTo (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))))))) (TermIdent (Id "dir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "select")) (TermBinOp Image (TermIdent (Id "Success")) (Set (Listing [TermBinOp Greater (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "parentdir")))])))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eOverflow"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "newsz")),DoBlock [DoItem (TermIdent (Id "time")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "vnode")))),DoItem (TermIdent (Id "dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "dir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_nlink"),TermBinOp Add (TermApp (TermIdent (Id "i_nlink")) (TermIdent (Id "dir"))) (ConstTerm (IntLiteral 1))),(TermIdent (Id "i_size"),TermIdent (Id "newsz"))]))),DoItem (TermIdent (Id "vnode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_nlink"),ConstTerm (IntLiteral 2))]))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "afs_inode_from_vnode")) (TermIdent (Id "vnode")))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "inode"))) (TermIdent (Id "inode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "dir"))) (TermIdent (Id "dir"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "parentdir")) (RecordUpd [(TermIdent (Id "v_nlink"),TermBinOp Add (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "parentdir"))) (ConstTerm (IntLiteral 1))),(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsz"))]),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]])]])]])]])]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_rmdir", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "vnode" []))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_rmdir")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "name"))) (TermIdent (Id "vnode"))) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermIdent (Id "error_if_readonly")) (TermIdent (Id "afs"))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "e"),TermIdent (Id "afs")] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "afs")),IfThenElse (TermBinOp NotEq (TermApp (TermIdent (Id "dom")) (TermApp (TermIdent (Id "i_dir")) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))))))) (Set (Listing []))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNotEmpty"))] ")")) (DoBlock [DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "time")] ")") (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "afs"))),DoItem (TermIdent (Id "vnode'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_nlink"),ConstTerm (IntLiteral 0))]))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "afs_inode_from_vnode")) (TermIdent (Id "vnode")))),DoItem (TermIdent (Id "newsize")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermBinOp Less (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "parentdir")))]))),DoItem (TermIdent (Id "dir_ino")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "parentdir")))),DoItem (TermIdent (Id "parentdir'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "parentdir")) (RecordUpd [(TermIdent (Id "v_nlink"),TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "parentdir"))) (ConstTerm (IntLiteral 1))),(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsize"))]))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermIdent (Id "dir_ino")) (TermApp (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermIdent (Id "option.None")))))) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermIdent (Id "f")) (TermIdent (Id "dir_ino"))))) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_nlink"),TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "parentdir'")))])),TermBinOp MapsTo (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))) (TermIdent (Id "inode"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir'"),TermIdent (Id "vnode'")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]]))]])}),Definition (Def {defSig = Just (Sig {sigName = "afs_symlink", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "VfsMode" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "vnode" []))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_symlink")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "name"))) (TermIdent (Id "symname"))) (TermIdent (Id "mode"))) (TermIdent (Id "vnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (IfThenElse (TermBinOp Greater (TermApp (TermIdent (Id "wordarray_length")) (TermIdent (Id "symname"))) (TermIdent (Id "bilbyFsBlockSize"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))] ")")) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_init_inode")) (TermIdent (Id "afs"))) (TermIdent (Id "parentdir"))) (TermIdent (Id "vnode"))) (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "mode")) (TermIdent (Id "OR"))) (TermIdent (Id "s_IFLNK"))) (TermIdent (Id "OR"))) (TermIdent (Id "s_IRWXUGO")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNFile"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")"),DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "parentdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapsTo (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))))))) (TermIdent (Id "dir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "select")) (TermBinOp Image (TermIdent (Id "Success")) (Set (Listing [TermBinOp Greater (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "parentdir")))])))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eOverflow"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "newsz")),DoBlock [DoItem (TermIdent (Id "time")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "vnode")))),DoItem (TermIdent (Id "vnode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_size"),TermBinOp DollarApp (TermIdent (Id "ucast")) (TermApp (TermIdent (Id "wordarray_length")) (TermIdent (Id "symname"))))]))),DoItem (TermIdent (Id "dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "dir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_size"),TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode")))]))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "afs_inode_from_vnode")) (TermIdent (Id "vnode")))),DoItem (TermIdent (Id "inode")) (TermApp (TermIdent (Id "return")) (TermApp (TermApp (TermIdent (Id "i_path_update")) (QuantifiedTerm Lambda [TermIdent Wildcard] (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "symname"))))) (TermIdent (Id "inode")))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "inode"))) (TermIdent (Id "inode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "dir"))) (TermIdent (Id "dir"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "parentdir"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "parentdir")) (RecordUpd [(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsz"))]),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]])]])]])]])]])))}),Definition (Def {defSig = Just (Sig {sigName = "pad_block", sigType = Just (TyArrow (TyDatatype "list" [TyDatatype "U8" []]) (TyArrow (TyDatatype "U32" []) (TyDatatype "list" [TyDatatype "U8" []])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "pad_block")) (TermIdent (Id "data"))) (TermIdent (Id "len"))) (TermBinOp Append (TermIdent (Id "data")) (TermApp (TermApp (TermIdent (Id "drop")) (TermApp (TermIdent (Id "length")) (TermIdent (Id "data")))) (TermApp (TermApp (TermIdent (Id "replicate")) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "len")))) (ConstTerm (IntLiteral 0)))))}),Definition (Def {defSig = Just (Sig {sigName = "afs_readpage", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "U64" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "WordArray" [TyDatatype "U8" []]))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_readpage")) (TermIdent (Id "afs"))) (TermIdent (Id "vnode"))) (TermIdent (Id "block"))) (TermIdent (Id "buf"))) (IfThenElse (TermBinOp Greater (TermIdent (Id "block")) (TermBinOp Shiftr (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode"))) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "bilbyFsBlockShift"))))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermApp (TermIdent (Id "WordArrayT.make")) (TermApp (TermApp (TermIdent (Id "replicate")) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "bilbyFsBlockSize")))) (ConstTerm (IntLiteral 0)))] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNoEnt"))] ")")) (IfThenElse (TermBinOp Conj (TermBinOp Eq (TermIdent (Id "block")) (TermBinOp Shiftr (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode"))) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "bilbyFsBlockShift"))))) (TermBinOp Eq (TermApp (TermApp (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode"))) (TermIdent (Id "mod"))) (TermApp (TermIdent (Id "ucast")) (TermIdent (Id "bilbyFsBlockSize")))) (ConstTerm (IntLiteral 0)))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "buf")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")) (DoBlock [DoItem (TermIdent (Id "err")) (Set (Listing [TermIdent (Id "eIO"),TermIdent (Id "eNoMem"),TermIdent (Id "eInval"),TermIdent (Id "eBadF"),TermIdent (Id "eNoEnt")])),TermBinOp Alt (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermApp (TermIdent (Id "WordArrayT.make")) (TermApp (TermApp (TermIdent (Id "pad_block")) (TermBinOp Nth (TermApp (TermIdent (Id "i_data")) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode")))))) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "block"))))) (TermIdent (Id "bilbyFsBlockSize")))] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "buf")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "err"))] ")"))])))}),Definition (Def {defSig = Just (Sig {sigName = "afs_write_begin", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "U64" []) (TyArrow (TyDatatype "U32" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "WordArray" [TyDatatype "U8" []]))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_write_begin")) (TermIdent (Id "afs"))) (TermIdent (Id "vnode"))) (TermIdent (Id "pos"))) (TermIdent (Id "len"))) (TermIdent (Id "buf"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "buf")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "buf'")] ")",TermIdent (Id "r")] ")") (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_readpage")) (TermIdent (Id "afs"))) (TermIdent (Id "vnode"))) (TermBinOp Shiftr (TermIdent (Id "pos")) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "bilbyFsBlockShift"))))) (TermIdent (Id "buf"))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "buf'")] ")",IfThenElse (TermBinOp Eq (TermIdent (Id "e")) (TermIdent (Id "eNoEnt"))) (TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "buf'")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_write_end", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "U64" []) (TyArrow (TyDatatype "U32" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyDatatype "vnode" [])) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_write_end")) (TermIdent (Id "afs"))) (TermIdent (Id "vnode"))) (TermIdent (Id "pos"))) (TermIdent (Id "len"))) (TermIdent (Id "addr"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "newsize")) (TermApp (TermIdent (Id "return")) (TermApp (TermApp (TermIdent (Id "max")) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode")))) (TermBinOp Add (TermIdent (Id "pos")) (TermApp (TermIdent (Id "ucast")) (TermIdent (Id "len")))))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "time")] ")") (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "afs"))),DoItem (TermIdent (Id "vnode'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_size"),TermIdent (Id "newsize")),(TermIdent (Id "v_mtime"),TermIdent (Id "time"))]))),DoItem (TermIdent (Id "block")) (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "unat")) (TermBinOp Shiftr (TermIdent (Id "pos")) (TermApp (TermIdent (Id "unat")) (TermIdent (Id "bilbyFsBlockShift")))))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (TermBinOp MapsTo (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))) (TermApp (TermApp (TermApp (TermIdent (Id "i_data_update")) (QuantifiedTerm Lambda [TermIdent (Id "data")] (TermApp (TermIdent (Id "data")) (ListTerm "[" [TermBinOp MapUpd (TermIdent (Id "block")) (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "addr")))] "]")))) (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermIdent (Id "f")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode")))))) (RecordUpd [(TermIdent (Id "i_size"),TermIdent (Id "newsize"))])))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode'")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_evict_inode", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyDatatype "afs_state" []) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "afs_evict_inode")) (TermIdent (Id "afs"))) (TermIdent (Id "vnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (IfThenElse (TermBinOp NotEq (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "vnode"))) (ConstTerm (IntLiteral 0))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")) (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (TermBinOp MapUpd (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))) (TermIdent (Id "None"))))))))}),Definition (Def {defSig = Just (Sig {sigName = "afs_follow_link", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "WordArray" [TyDatatype "U8" []]))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermIdent (Id "afs_follow_link")) (TermIdent (Id "afs"))) (TermIdent (Id "vnode"))) (TermIdent (Id "path"))) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "path")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "inode")),LetIn [(TermIdent (Id "wa_path"),TermApp (TermIdent (Id "WordArrayT.make")) (TermApp (TermIdent (Id "i_path")) (TermIdent (Id "inode")))),(TermIdent (Id "updated_path"),TermApp (TermIdent (Id "wordarray_copy")) (ListTerm "(" [TermIdent (Id "path"),TermIdent (Id "wa_path"),ConstTerm (IntLiteral 0),ConstTerm (IntLiteral 0),TermApp (TermIdent (Id "ucast")) (TermApp (TermIdent (Id "i_size")) (TermIdent (Id "inode")))] ")"))] (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode"),TermIdent (Id "updated_path")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")))]])}),Definition (Def {defSig = Just (Sig {sigName = "afs_rename", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "option" [TyDatatype "vnode" []]) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "option" [TyDatatype "vnode" []])))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_rename")) (TermIdent (Id "afs"))) (TermIdent (Id "vdir"))) (TermIdent (Id "oldname"))) (TermIdent (Id "oldvnode"))) (TermIdent (Id "newname"))) (TermIdent (Id "onewvnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir"),TermIdent (Id "oldvnode"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "old_is_dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "S_ISDIR")) (TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "oldvnode"))))),DoItem (TermIdent (Id "ncnt")) (TermApp (TermIdent (Id "return")) (IfThenElse (TermIdent (Id "old_is_dir")) (TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "oldvnode"))) (ConstTerm (IntLiteral 1))) (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "oldvnode"))))),DoItem (TermIdent (Id "oldvnode'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "oldvnode")) (RecordUpd [(TermIdent (Id "v_nlink"),TermIdent (Id "ncnt"))]))),DoItem (TermIdent (Id "oldinode")) (TermApp (TermIdent (Id "return")) (TermApp (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "oldvnode"))))) (RecordUpd [(TermIdent (Id "i_nlink"),TermIdent (Id "ncnt"))]))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "time")] ")") (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "afs"))),DoItem (TermIdent (Id "newsz")) (TermApp (TermIdent (Id "select")) (TermIdent (Id "UNIV"))),DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir"),TermIdent (Id "oldvnode"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (ListTerm "(" [TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "oldname"))) (TermIdent (Id "None")),TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "newname"))) (TermApp (TermIdent (Id "Some")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "oldvnode"))))] ")")))) (TermIdent (Id "dir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir"),TermIdent (Id "oldvnode"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "dir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_size"),TermIdent (Id "newsz"))]))),CaseOf (TermIdent (Id "onewvnode")) [(TermApp (TermIdent (Id "Some")) (TermIdent (Id "newvnode")),LetIn [(TermIdent (Id "newinode"),TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "newvnode"))))),(TermIdent (Id "new_is_dir"),TermApp (TermIdent (Id "afs_inode_is_dir")) (TermApp (TermIdent (Id "i_type")) (TermIdent (Id "newinode"))))] (IfThenElse (TermBinOp Conj (TermIdent (Id "new_is_dir")) (TermBinOp NotEq (TermApp (TermIdent (Id "dom")) (TermApp (TermIdent (Id "i_dir")) (TermIdent (Id "newinode")))) (Set (Listing [])))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir"),TermIdent (Id "oldvnode"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNotEmpty"))] ")")) (DoBlock [DoItem (TermIdent (Id "ncnt")) (TermApp (TermIdent (Id "return")) (IfThenElse (TermIdent (Id "new_is_dir")) (ConstTerm (IntLiteral 0)) (TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "newvnode"))) (ConstTerm (IntLiteral 1))))),DoItem (TermIdent (Id "newvnode'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "newvnode")) (RecordUpd [(TermIdent (Id "v_nlink"),TermIdent (Id "ncnt"))]))),DoItem (TermIdent (Id "newinode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "newinode")) (RecordUpd [(TermIdent (Id "i_nlink"),TermIdent (Id "ncnt"))]))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "oldinode"))) (TermIdent (Id "oldinode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "dir"))) (TermIdent (Id "dir")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "newinode"))) (TermIdent (Id "newinode"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir"),TermIdent (Id "oldvnode"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),LetIn [(TermIdent (Id "vdir'"),TermApp (TermIdent (Id "vdir")) (RecordUpd [(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsz"))]))] (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir'"),TermIdent (Id "oldvnode'"),TermApp (TermIdent (Id "Some")) (TermIdent (Id "newvnode'"))] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")))]]))),(TermIdent (Id "None"),DoBlock [DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "oldinode"))) (TermIdent (Id "oldinode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "dir"))) (TermIdent (Id "dir"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir"),TermIdent (Id "oldvnode"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),LetIn [(TermIdent (Id "vdir'"),TermApp (TermIdent (Id "vdir")) (RecordUpd [(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "newsz"))]))] (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vdir'"),TermIdent (Id "oldvnode'"),TermIdent (Id "None")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")))]])]])]])]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_move", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "vnode" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "option" [TyDatatype "vnode" []]) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "vnode" []) (TyTuple (TyDatatype "vnode" []) (TyTuple (TyDatatype "vnode" []) (TyDatatype "option" [TyDatatype "vnode" []]))))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_move")) (TermIdent (Id "afs"))) (TermIdent (Id "oldvdir"))) (TermIdent (Id "oldname"))) (TermIdent (Id "oldvnode"))) (TermIdent (Id "newvdir"))) (TermIdent (Id "newname"))) (TermIdent (Id "onewvnode"))) (IfThenElse (TermApp (TermIdent (Id "a_is_readonly")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eRoFs"))] ")")) (DoBlock [DoItem (TermIdent (Id "old_is_dir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "S_ISDIR")) (TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "oldvnode"))))),DoItem (TermIdent (Id "ncnt")) (TermApp (TermIdent (Id "return")) (IfThenElse (TermIdent (Id "old_is_dir")) (TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "oldvnode"))) (ConstTerm (IntLiteral 1))) (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "oldvnode"))))),DoItem (TermIdent (Id "oldvnode'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "oldvnode")) (RecordUpd [(TermIdent (Id "v_nlink"),TermIdent (Id "ncnt"))]))),DoItem (TermIdent (Id "oldinode")) (TermApp (TermIdent (Id "return")) (TermApp (TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "oldvnode"))))) (RecordUpd [(TermIdent (Id "i_nlink"),TermIdent (Id "ncnt"))]))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "time")] ")") (TermApp (TermIdent (Id "afs_get_current_time")) (TermIdent (Id "afs"))),DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "oldvdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "olddir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (ListTerm "(" [TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "oldname"))) (TermIdent (Id "None")),TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "newname"))) (TermApp (TermIdent (Id "Some")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "oldvnode"))))] ")")))) (TermIdent (Id "olddir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "olddir")),DoBlock [DoItem (TermIdent (Id "onewsz")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermBinOp Less (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "oldvdir")))]))),DoItem (TermIdent (Id "olddir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "olddir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_size"),TermIdent (Id "onewsz"))]))),DoItem (TermIdent (Id "oldvdir'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "oldvdir")) (RecordUpd [(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_size"),TermIdent (Id "onewsz"))]))),DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "newvdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "newdir")),DoBlock [DoItem (TermIdent (Id "r")) (TermBinOp Alt (TermApp (TermIdent (Id "return")) (TermBinOp DollarApp (TermIdent (Id "Success")) (TermApp (TermApp (TermIdent (Id "i_dir_update")) (QuantifiedTerm Lambda [TermIdent (Id "d")] (TermApp (TermIdent (Id "d")) (TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "newname"))) (TermApp (TermIdent (Id "Some")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "oldvnode")))))))) (TermIdent (Id "newdir"))))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNameTooLong"))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "newdir")),DoBlock [DoItem (TermIdent (Id "nnewsz")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermBinOp Greater (TermApp (TermIdent (Id "sz.")) (TermIdent (Id "sz"))) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "newvdir")))]))),DoItem (TermIdent (Id "ncnt")) (TermApp (TermIdent (Id "return")) (IfThenElse (TermIdent (Id "old_is_dir")) (TermBinOp Add (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "newvdir"))) (ConstTerm (IntLiteral 1))) (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "newvdir"))))),DoItem (TermIdent (Id "newvdir'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "newvdir")) (RecordUpd [(TermIdent (Id "v_ctime"),TermIdent (Id "time")),(TermIdent (Id "v_mtime"),TermIdent (Id "time")),(TermIdent (Id "v_nlink"),TermIdent (Id "ncnt")),(TermIdent (Id "v_size"),TermIdent (Id "nnewsz"))]))),DoItem (TermIdent (Id "newdir")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "newdir")) (RecordUpd [(TermIdent (Id "i_ctime"),TermIdent (Id "time")),(TermIdent (Id "i_mtime"),TermIdent (Id "time")),(TermIdent (Id "i_nlink"),TermIdent (Id "ncnt")),(TermIdent (Id "i_size"),TermIdent (Id "nnewsz"))]))),CaseOf (TermIdent (Id "onewvnode")) [(TermApp (TermIdent (Id "Some")) (TermIdent (Id "newvnode")),LetIn [(TermIdent (Id "newinode"),TermBinOp DollarApp (TermIdent (Id "the")) (TermApp (TermApp (TermIdent (Id "updated_afs")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "newvnode"))))),(TermIdent (Id "new_is_dir"),TermApp (TermIdent (Id "afs_inode_is_dir")) (TermApp (TermIdent (Id "i_type")) (TermIdent (Id "newinode"))))] (IfThenElse (TermBinOp Conj (TermIdent (Id "new_is_dir")) (TermBinOp NotEq (TermApp (TermIdent (Id "dom")) (TermApp (TermIdent (Id "i_dir")) (TermIdent (Id "newinode")))) (Set (Listing [])))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "eNotEmpty"))] ")")) (DoBlock [DoItem (TermIdent (Id "ncnt")) (TermApp (TermIdent (Id "return")) (IfThenElse (TermIdent (Id "new_is_dir")) (ConstTerm (IntLiteral 0)) (TermBinOp Minus (TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "newvnode"))) (ConstTerm (IntLiteral 1))))),DoItem (TermIdent (Id "newvnode'")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "newvnode")) (RecordUpd [(TermIdent (Id "v_nlink"),TermIdent (Id "ncnt"))]))),DoItem (TermIdent (Id "newinode")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "newinode")) (RecordUpd [(TermIdent (Id "i_nlink"),TermIdent (Id "ncnt"))]))),DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "oldinode"))) (TermIdent (Id "oldinode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "olddir"))) (TermIdent (Id "olddir")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "newdir"))) (TermIdent (Id "newdir")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "newinode"))) (TermIdent (Id "newinode"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir'"),TermIdent (Id "oldvnode'"),TermIdent (Id "newvdir'"),TermApp (TermIdent (Id "Some")) (TermIdent (Id "newvnode'"))] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]]))),(TermIdent (Id "None"),DoBlock [DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (ListTerm "(" [TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "oldinode"))) (TermIdent (Id "oldinode")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "olddir"))) (TermIdent (Id "olddir")),TermBinOp MapsTo (TermApp (TermIdent (Id "i_ino")) (TermIdent (Id "newdir"))) (TermIdent (Id "newdir"))] ")")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir"),TermIdent (Id "oldvnode"),TermIdent (Id "newvdir"),TermIdent (Id "onewvnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "oldvdir'"),TermIdent (Id "oldvnode'"),TermIdent (Id "newvdir'"),TermIdent (Id "None")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]])]])]])]])]])]]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_dir_emit", sigType = Just (TyArrow (TyDatatype "readdir_ctx" []) (TyArrow (TyDatatype "WordArray" [TyDatatype "U8" []]) (TyArrow (TyDatatype "Ino" []) (TyArrow (TyDatatype "VfsType" []) (TyDatatype "cogent_monad" [TyDatatype "LoopResult\\<^sub>T" [TyDatatype "readdir_ctx" [],TyDatatype "readdir_ctx" []]])))))}), defTerm = TermBinOp Equiv (TermIdent (Id "afs_dir_emit")) (QuantifiedTerm Lambda [ListTerm "(" [TermIdent (Id "pos"),TermIdent (Id "entries")] ")",TermIdent (Id "name"),TermIdent (Id "ino"),TermIdent (Id "vtype")] (DoBlock [DoItem (TermIdent (Id "bool")) (TermApp (TermIdent (Id "select")) (TermIdent (Id "UNIV"))),IfThenElse (TermIdent (Id "bool")) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Iterate")) (ListTerm "(" [TermIdent (Id "pos"),TermApp (TermIdent (Id "entries")) (TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermIdent (Id "None")))] ")"))) (TermApp (TermIdent (Id "return")) (TermApp (TermIdent (Id "Break")) (ListTerm "(" [TermIdent (Id "pos"),TermApp (TermIdent (Id "entries")) (TermBinOp MapUpd (TermApp (TermIdent (Id "\\<alpha>wa")) (TermIdent (Id "name"))) (TermIdent (Id "None")))] ")")))]))}),Definition (Def {defSig = Just (Sig {sigName = "afs_readdir", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "readdir_ctx" []) (TyArrow (TyDatatype "option" [TyDatatype "BilbyFsReaddirContext\\<^sub>T" []]) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyTuple (TyDatatype "readdir_ctx" []) (TyDatatype "option" [TyDatatype "BilbyFsReaddirContext\\<^sub>T" []]))) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])])))))}), defTerm = TermBinOp Eq (TermApp (TermApp (TermApp (TermApp (TermIdent (Id "afs_readdir")) (TermIdent (Id "afs"))) (TermIdent (Id "rdctx"))) (TermIdent (Id "obrdctx"))) (TermIdent (Id "vdir"))) (DoBlock [DoItem (TermIdent (Id "r")) (TermApp (TermApp (TermIdent (Id "read_afs_inode")) (TermIdent (Id "afs"))) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vdir")))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "rdctx"),TermIdent (Id "obrdctx")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (TermIdent (Id "dir")),DoBlock [DoItem (TermIdent (Id "toemit")) (TermApp (TermIdent (Id "select")) (Set (Listing [TermBinOp SubSetEq (TermApp (TermIdent (Id "entries.")) (TermIdent (Id "entries"))) (TermApp (TermIdent (Id "dom")) (TermApp (TermIdent (Id "i_dir")) (TermIdent (Id "dir"))))]))),DoItem (TermIdent (Id "obrdctx")) (TermApp (TermIdent (Id "select")) (TermIdent (Id "UNIV"))),DoItem (TermIdent (Id "pos")) (TermApp (TermIdent (Id "select")) (TermIdent (Id "UNIV"))),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),ListTerm "(" [TermIdent (Id "pos"),TermBinOp RestrictMp (TermApp (TermIdent (Id "snd")) (TermIdent (Id "rdctx"))) (TermUnOp Uminus (TermIdent (Id "toemit")))] ")",TermIdent (Id "obrdctx")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")")])]])}),RecordDecl (Record {recName = "vfsstat", recFields = [RecField {fieldName = "vs_ino", fieldType = TyDatatype "Ino" []},RecField {fieldName = "vs_nlink", fieldType = TyDatatype "U32" []},RecField {fieldName = "vs_mode", fieldType = TyDatatype "Mode" []},RecField {fieldName = "vs_uid", fieldType = TyDatatype "U32" []},RecField {fieldName = "vs_gid", fieldType = TyDatatype "U32" []},RecField {fieldName = "vs_size", fieldType = TyDatatype "U64" []},RecField {fieldName = "vs_atime", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "vs_mtime", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "vs_ctime", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "vs_blksize", fieldType = TyDatatype "U32" []},RecField {fieldName = "vs_blocks", fieldType = TyDatatype "U32" []}], recTypeVars = []}),Definition (Def {defSig = Just (Sig {sigName = "afs_getattr", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "vfsstat" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyDatatype "afs_state" []) (TyDatatype "vfsstat" [])]))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermIdent (Id "afs_getattr")) (TermIdent (Id "afs"))) (TermIdent (Id "stat"))) (TermIdent (Id "vnode"))) (TermApp (TermIdent (Id "return")) (ListTerm "(" [TermIdent (Id "afs"),TermApp (TermIdent (Id "stat")) (RecordUpd [(TermIdent (Id "vs_ino"),TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_nlink"),TermApp (TermIdent (Id "v_nlink")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_mode"),TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_uid"),TermApp (TermIdent (Id "v_uid")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_gid"),TermApp (TermIdent (Id "v_gid")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_size"),TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_atime"),TermApp (TermIdent (Id "v_mtime")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_mtime"),TermApp (TermIdent (Id "v_mtime")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_ctime"),TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "vnode"))),(TermIdent (Id "vs_blksize"),TermIdent (Id "bilbyFsBlockSize")),(TermIdent (Id "vs_blocks"),TermBinOp Add (TermApp (TermApp (TermApp (TermIdent (Id "ucast")) (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode")))) (TermIdent (Id "div"))) (ConstTerm (IntLiteral 512))) (IfThenElse (TermBinOp Greater (TermApp (TermApp (TermApp (TermIdent (Id "v_size")) (TermIdent (Id "vnode"))) (TermIdent (Id "mod"))) (ConstTerm (IntLiteral 512))) (ConstTerm (IntLiteral 0))) (ConstTerm (IntLiteral 1)) (ConstTerm (IntLiteral 0))))])] ")"))}),RecordDecl (Record {recName = "iattr", recFields = [RecField {fieldName = "iattr_valid", fieldType = TyDatatype "U32" []},RecField {fieldName = "iattr_mode", fieldType = TyDatatype "Mode" []},RecField {fieldName = "iattr_uid", fieldType = TyDatatype "U32" []},RecField {fieldName = "iattr_gid", fieldType = TyDatatype "U32" []},RecField {fieldName = "iattr_mtime", fieldType = TyDatatype "TimeT" []},RecField {fieldName = "iattr_ctime", fieldType = TyDatatype "TimeT" []}], recTypeVars = []}),Definition (Def {defSig = Just (Sig {sigName = "iattr_is_set", sigType = Just (TyArrow (TyDatatype "iattr" []) (TyArrow (TyDatatype "U32" []) (TyPrim BoolT)))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermIdent (Id "iattr_is_set")) (TermIdent (Id "iattr"))) (TermIdent (Id "flag"))) (TermBinOp NotEq (TermApp (TermApp (TermApp (TermIdent (Id "iattr_valid")) (TermIdent (Id "iattr"))) (TermIdent (Id "AND"))) (TermIdent (Id "flag"))) (ConstTerm (IntLiteral 0)))}),Definition (Def {defSig = Just (Sig {sigName = "afs_setattr", sigType = Just (TyArrow (TyDatatype "afs_state" []) (TyArrow (TyDatatype "iattr" []) (TyArrow (TyDatatype "vnode" []) (TyDatatype "cogent_monad" [TyTuple (TyTuple (TyDatatype "afs_state" []) (TyDatatype "vnode" [])) (TyDatatype "R\\<^sub>T" [TyDatatype "unit" [],TyDatatype "ErrCode" []])]))))}), defTerm = TermBinOp Equiv (TermApp (TermApp (TermApp (TermIdent (Id "afs_setattr")) (TermIdent (Id "afs"))) (TermIdent (Id "iattr"))) (TermIdent (Id "vnode"))) (LetIn [(TermIdent (Id "vnode'"),IfThenElse (TermApp (TermApp (TermIdent (Id "iattr_is_set")) (TermIdent (Id "iattr"))) (TermIdent (Id "vfs_ATTR_MODE"))) (TermApp (TermIdent (Id "vnode")) (RecordUpd [(TermIdent (Id "v_mode"),TermApp (TermIdent (Id "iattr_mode")) (TermIdent (Id "iattr")))])) (TermIdent (Id "vnode"))),(TermIdent (Id "vnode'"),IfThenElse (TermApp (TermApp (TermIdent (Id "iattr_is_set")) (TermIdent (Id "iattr"))) (TermIdent (Id "vfs_ATTR_UID"))) (TermApp (TermIdent (Id "vnode'")) (RecordUpd [(TermIdent (Id "v_uid"),TermApp (TermIdent (Id "iattr_uid")) (TermIdent (Id "iattr")))])) (TermIdent (Id "vnode'"))),(TermIdent (Id "vnode'"),IfThenElse (TermApp (TermApp (TermIdent (Id "iattr_is_set")) (TermIdent (Id "iattr"))) (TermIdent (Id "vfs_ATTR_GID"))) (TermApp (TermIdent (Id "vnode'")) (RecordUpd [(TermIdent (Id "v_gid"),TermApp (TermIdent (Id "iattr_gid")) (TermIdent (Id "iattr")))])) (TermIdent (Id "vnode'"))),(TermIdent (Id "vnode'"),IfThenElse (TermApp (TermApp (TermIdent (Id "iattr_is_set")) (TermIdent (Id "iattr"))) (TermIdent (Id "vfs_ATTR_MTIME"))) (TermApp (TermIdent (Id "vnode'")) (RecordUpd [(TermIdent (Id "v_mtime"),TermApp (TermIdent (Id "iattr_mtime")) (TermIdent (Id "iattr")))])) (TermIdent (Id "vnode'"))),(TermIdent (Id "vnode'"),IfThenElse (TermApp (TermApp (TermIdent (Id "iattr_is_set")) (TermIdent (Id "iattr"))) (TermIdent (Id "vfs_ATTR_CTIME"))) (TermApp (TermIdent (Id "vnode'")) (RecordUpd [(TermIdent (Id "v_ctime"),TermApp (TermIdent (Id "iattr_ctime")) (TermIdent (Id "iattr")))])) (TermIdent (Id "vnode'")))] (DoBlock [DoItem (ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "r")] ")") (TermApp (TermApp (TermIdent (Id "afs_update")) (TermIdent (Id "afs"))) (QuantifiedTerm Lambda [TermIdent (Id "f")] (TermApp (TermIdent (Id "f")) (TermBinOp MapsTo (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode'"))) (TermApp (TermApp (TermIdent (Id "the")) (TermApp (TermIdent (Id "f")) (TermApp (TermIdent (Id "v_ino")) (TermIdent (Id "vnode'"))))) (RecordUpd [(TermIdent (Id "i_mode"),TermApp (TermIdent (Id "v_mode")) (TermIdent (Id "vnode'"))),(TermIdent (Id "i_uid"),TermApp (TermIdent (Id "v_uid")) (TermIdent (Id "vnode'"))),(TermIdent (Id "i_gid"),TermApp (TermIdent (Id "v_gid")) (TermIdent (Id "vnode'"))),(TermIdent (Id "i_mtime"),TermApp (TermIdent (Id "v_mtime")) (TermIdent (Id "vnode'"))),(TermIdent (Id "i_ctime"),TermApp (TermIdent (Id "v_ctime")) (TermIdent (Id "vnode'")))])))))),CaseOf (TermIdent (Id "r")) [(TermApp (TermIdent (Id "Error")) (TermIdent (Id "e")),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode")] ")",TermApp (TermIdent (Id "Error")) (TermIdent (Id "e"))] ")")),(TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")"),TermApp (TermIdent (Id "return")) (ListTerm "(" [ListTerm "(" [TermIdent (Id "afs"),TermIdent (Id "vnode'")] ")",TermApp (TermIdent (Id "Success")) (ListTerm "(" [] ")")] ")"))]]))})]}